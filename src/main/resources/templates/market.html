<!DOCTYPE html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="#{hub.market_title}">Piyasa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<nav class="navbar navbar-dark bg-transparent py-3 mb-4 border-bottom border-secondary">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">
            <i class="fas fa-arrow-left me-2"></i>
            <span th:text="#{nav.home}">Merkeze Dön</span>
        </a>

        <div class="d-flex align-items-center">
            <div class="me-4 border-end border-secondary pe-3">
                <a href="?lang=tr" class="text-white small fw-bold text-decoration-none me-2">TR</a>
                <span class="text-secondary">|</span>
                <a href="?lang=en" class="text-white small fw-bold text-decoration-none ms-2">EN</a>
            </div>

            <span class="text-white-50" th:text="#{market.subtitle}">Canlı Piyasa Verileri</span>
        </div>
    </div>
</nav>

<div class="container">
    <div class="glass-card p-4">
        <h3 class="mb-4 text-white">
            <i class="fas fa-globe me-2"></i>
            <span th:text="#{market.popular_stocks}">Popüler Hisseler</span>
        </h3>

        <table class="table table-dark-custom table-hover">
            <thead>
            <tr>
                <th th:text="#{col.symbol}">Sembol</th>
                <th th:text="#{col.company}">Şirket</th>
                <th th:text="#{col.price}">Fiyat</th>
                <th th:text="#{col.change}">Değişim</th>
            </tr>
            </thead>
            <tbody id="marketTableBody">
            <tr id="loadingRow">
                <td colspan="4" class="text-center py-4 text-secondary" th:text="#{msg.loading}">Yükleniyor...</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const stocksToWatch = [
        { s: 'AAPL', n: 'Apple Inc.' },
        { s: 'MSFT', n: 'Microsoft Corp.' },
        { s: 'TSLA', n: 'Tesla Inc.' },
        { s: 'GOOGL', n: 'Alphabet (Google)' },
        { s: 'AMZN', n: 'Amazon.com' },
        { s: 'NVDA', n: 'NVIDIA Corp.' },
        { s: 'META', n: 'Meta Platforms' }
    ];

    $(document).ready(function() {
        var tableBody = $("#marketTableBody");
        tableBody.empty();

        stocksToWatch.forEach(function(stock) {
            var rowId = "row-" + stock.s.replace('.', '-');
            var rowHtml = `
                    <tr id="${rowId}">
                        <td class="fw-bold text-primary">${stock.s}</td>
                        <td>${stock.n}</td>
                        <td class="price-cell">...</td>
                        <td class="change-cell text-muted">-</td>
                    </tr>
                `;
            tableBody.append(rowHtml);

            $.get("/api/stocks/price?symbol=" + stock.s, function(price) {
                $("#" + rowId + " .price-cell").text(price + " $").addClass("text-neon-green");
            });
        });
    });
</script>
</body>
</html>